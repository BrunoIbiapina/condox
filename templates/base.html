<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}CondoX{% endblock %}</title>

    <!-- Fonts + Tailwind -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root{
        --brand:#16a34a;           /* verde-600 */
        --brand-500:#22c55e;       /* verde-500 hover */
        --ink:#0f172a;             /* slate-900 */
        --muted:#64748b;           /* slate-500 */
        --card:#ffffff;
        --line:#e2e8f0;            /* slate-200 */
        --bg:#f8fafc;              /* slate-50 */
        --chip:#f1f5f9;            /* slate-100 */
      }
      html,body{height:100%}
      body{font-family:Inter, ui-sans-serif, system-ui; background:var(--bg); color:var(--ink);}
      .card{background:var(--card); border:1px solid var(--line); border-radius:18px; box-shadow:0 8px 30px rgba(2,6,23,.05);}
      .btn{display:inline-flex; align-items:center; gap:.5rem; padding:.65rem 1rem; border-radius:12px; border:1px solid var(--line); font-weight:600;}
      .btn-primary{background:var(--brand); color:#fff; border-color:var(--brand);}
      .btn-primary:hover{background:var(--brand-500)}
      .btn-ghost{background:#fff}
      .chip{background:var(--chip); color:var(--muted); padding:.35rem .6rem; border-radius:999px; font-weight:600; font-size:.8rem}
      .field{background:#fff; border:1px solid var(--line); border-radius:12px; padding:.65rem .9rem; outline:none}
      .field:focus{border-color:var(--brand); box-shadow:0 0 0 4px rgba(34,197,94,.15)}
      .pill-input{display:flex; gap:.5rem; background:#fff; border:2px solid #cce8d6; border-radius:999px; padding:.35rem; box-shadow:inset 0 0 0 1px #def7e6}
      .pill-input input{border:0; outline:0; padding:.55rem .9rem; border-radius:999px}
      .sidebar-link{display:flex; gap:.6rem; align-items:center; padding:.65rem .9rem; border-radius:12px; color:var(--muted); transition:background .2s, color .2s}
      .sidebar-link.active, .sidebar-link:hover{background:#e8f6ee; color:#065f46}

      /* ======== COLAPSO (desktop) ======== */
      /* quando o body tem .is-collapsed, a sidebar encolhe */
      body.is-collapsed .sidebar {
        width: 72px;
      }
      body.is-collapsed .sidebar .brand-text,
      body.is-collapsed .sidebar .link-text,
      body.is-collapsed .sidebar .logout-text {
        display: none;
      }
      body.is-collapsed .sidebar .sidebar-link {
        justify-content: center;
      }

      /* animações suaves */
      .sidebar {
        transition: width .2s ease, transform .25s ease;
      }

      /* ======== MOBILE (drawer) ======== */
      /* por padrão mobile: sidebar escondida e aparece como drawer */
      @media (max-width: 767px) {
        .sidebar {
          position: fixed;
          inset: 0 auto 0 0;
          transform: translateX(-100%);
          width: 260px;
          background: #fff;
          z-index: 60;
          box-shadow: 0 10px 40px rgba(2,6,23,.2);
        }
        .sidebar.is-open {
          transform: translateX(0);
        }
        .drawer-overlay {
          position: fixed;
          inset: 0;
          background: rgba(15, 23, 42, .45);
          z-index: 50;
          opacity: 0;
          pointer-events: none;
          transition: opacity .2s ease;
        }
        .drawer-overlay.is-open {
          opacity: 1;
          pointer-events: auto;
        }
      }
    </style>
  </head>
  <body class="min-h-full">
    {% block navbar %}
    <!-- Layout com sidebar -->
    <div class="flex min-h-screen">
      <!-- Overlay para mobile -->
      <div id="drawerOverlay" class="drawer-overlay md:hidden"></div>

      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar w-[250px] hidden md:flex md:flex-col border-r border-[var(--line)] bg-white">
        <div class="p-4 border-b border-[var(--line)] flex items-center gap-2">
          <img src="https://img.icons8.com/fluency/48/checked.png" class="w-6 h-6" alt="">
          <span class="font-semibold brand-text">CondoX</span>
        </div>
        <nav class="p-3 space-y-1">
          <a href="/" class="sidebar-link {% if request.path == '/' %}active{% endif %}">
            <i data-lucide="home" class="w-4 h-4"></i> <span class="link-text">Home</span>
          </a>
          <a href="/reservas/areas/" class="sidebar-link">
            <i data-lucide="calendar" class="w-4 h-4"></i> <span class="link-text">Reservas</span>
          </a>
          <a href="{% url 'financeiro:minhas_cobrancas' %}" class="sidebar-link">
            <i data-lucide="wallet" class="w-4 h-4"></i> <span class="link-text">Financeiro</span>
          </a>
          <a href="/assembleias/" class="sidebar-link">
            <i data-lucide="land-plot" class="w-4 h-4"></i> <span class="link-text">Assembleias</span>
          </a>
          <a href="/admin/" class="sidebar-link">
            <i data-lucide="settings" class="w-4 h-4"></i> <span class="link-text">Admin</span>
          </a>
        </nav>
        <div class="mt-auto p-3 border-t border-[var(--line)]">
          {% if user.is_authenticated %}
            <form method="post" action="{% url 'logout' %}">{% csrf_token %}
              <button class="btn w-full">
                <i data-lucide="log-out" class="w-4 h-4"></i> <span class="logout-text">Sair</span>
              </button>
            </form>
          {% else %}
            <a class="btn btn-primary w-full" href="/accounts/login/">
              <i data-lucide="log-in" class="w-4 h-4"></i> <span class="logout-text">Entrar</span>
            </a>
          {% endif %}
        </div>
      </aside>

      <!-- Conteúdo -->
      <div class="flex-1 min-w-0">
        <!-- Topbar -->
        <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-[var(--line)]">
          <div class="px-4 md:px-8 py-3 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <!-- Botão: abre drawer no mobile / colapsa no desktop -->
              <button id="sidebarToggle"
                      class="btn"
                      type="button"
                      aria-label="Alternar menu">
                <i data-lucide="menu" class="w-4 h-4"></i>
              </button>

              <!-- Busca (desktop) -->
              <div class="hidden md:flex pill-input w-[420px]">
                <input class="w-full" type="text" placeholder="Pesquisar CPF/CNPJ, reservas, unidades..." />
                <button class="btn-primary btn px-4" type="button">
                  <i data-lucide="search" class="w-4 h-4"></i>
                </button>
              </div>
            </div>

            <div class="flex items-center gap-2">
              <span class="hidden sm:inline chip">Olá, {{ user.first_name|default:user.username|default:'Visitante' }}</span>
              <img class="w-8 h-8 rounded-full ring-2 ring-[var(--line)]" src="https://api.dicebear.com/9.x/identicon/svg?seed={{ user.username|default:'x' }}" alt="">
            </div>
          </div>
        </header>

        <!-- Mensagens -->
        {% if messages %}
          <div class="px-4 md:px-8 pt-4 space-y-2">
            {% for message in messages %}
              <div class="card px-4 py-3 text-sm {% if message.tags == 'success' %}text-green-700 bg-green-50 border-green-200{% elif message.tags == 'error' %}text-red-700 bg-red-50 border-red-200{% else %}text-slate-700{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Página -->
        <main id="conteudo" class="px-4 md:px-8 py-6">
          {% block content %}{% endblock %}
        </main>
      </div>
    </div>
    {% endblock %}

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.lucide) lucide.createIcons();

        const btn = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('drawerOverlay');

        const isMobile = () => window.matchMedia('(max-width: 767px)').matches;

        // abre/fecha no mobile; colapsa/expande no desktop
        const toggleSidebar = () => {
          if (isMobile()) {
            sidebar.classList.toggle('is-open');
            overlay.classList.toggle('is-open');
          } else {
            document.body.classList.toggle('is-collapsed');
          }
        };

        btn.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        // garante que ao redimensionar, estados não fiquem travados
        window.addEventListener('resize', () => {
          if (!isMobile()) {
            sidebar.classList.remove('is-open');
            overlay.classList.remove('is-open');
          }
        });
      });
    </script>
  </body>
</html>