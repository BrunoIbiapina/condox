{% comment %} {% extends "base.html" %}
{% block title %}Dashboard ‚Ä¢ CondoX{% endblock %}

{% block content %}
<header class="mb-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Dashboard</h1>
      <p class="text-gray-500 text-sm mt-1">Vis√£o r√°pida das opera√ß√µes do condom√≠nio.</p>
    </div>
    <div class="flex items-center gap-2">
      <a href="{% url 'reservas:areas_list' %}" class="btn btn-primary">
        <i data-lucide="calendar-plus" class="w-4 h-4"></i> Nova reserva
      </a>
      <a href="{% url 'financeiro:minhas_cobrancas' %}" class="btn">
        <i data-lucide="wallet" class="w-4 h-4"></i> Financeiro
      </a>
    </div>
  </div>
</header>

<!-- KPIs -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="card p-5">
    <div class="text-xs text-gray-500 font-semibold">EM USO AGORA</div>
    <div class="text-3xl font-bold mt-1">{{ kpi_em_uso_agora|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-1">√Åreas em andamento</div>
  </div>

  <div class="card p-5">
    <div class="text-xs text-gray-500 font-semibold">RESERVAS HOJE</div>
    <div class="text-3xl font-bold mt-1">{{ kpi_reservas_hoje|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-1">Total de reservas do dia</div>
  </div>

  <div class="card p-5 {% if has_inadimplentes %}border-red-200 bg-red-50{% endif %}">
    <div class="text-xs font-semibold {% if has_inadimplentes %}text-red-700{% else %}text-gray-500{% endif %}">
      INADIMPLENTES
    </div>
    <div class="text-3xl font-bold mt-1 {% if has_inadimplentes %}text-red-700{% endif %}">
      {{ kpi_inadimplentes|default:"0" }}
    </div>
    <div class="text-sm mt-1 {% if has_inadimplentes %}text-red-700/80{% else %}text-gray-500{% endif %}">
      Vencidos e n√£o pagos
    </div>
  </div>

  <div class="card p-5">
    <div class="text-xs text-gray-500 font-semibold">PENDENTES</div>
    <div class="text-3xl font-bold mt-1 text-amber-600">{{ kpi_pendentes|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-1">A vencer</div>
  </div>
</div>

<!-- Linhas de cards -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-5">

  <!-- Em uso agora -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Em uso agora</h2>
      <a href="{% url 'reservas:areas_list' %}" class="text-sm link">reservar ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for r in em_uso %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0">
            <div class="font-medium truncate">{{ r.area.nome }}</div>
            <div class="text-gray-600 text-sm">
              {{ r.inicio|date:"H:i" }}‚Äì{{ r.fim|date:"H:i" }}
              {% if r.morador %} ‚Ä¢ {{ r.morador.username }}{% endif %}
            </div>
          </div>
          <span class="pill pill-em-uso">
            <i data-lucide="play-circle" class="w-3 h-3"></i>
            Em uso
          </span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Nenhuma √°rea em uso.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Reservas hoje -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Reservas hoje</h2>
      <a href="{% url 'reservas:areas_list' %}" class="text-sm link">ver √°reas ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for r in reservas_hoje %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0">
            <div class="font-medium truncate">{{ r.area.nome }}</div>
            <div class="text-gray-600 text-sm">
              {{ r.inicio|date:"H:i" }}‚Äì{{ r.fim|date:"H:i" }}
              {% if r.morador %} ‚Ä¢ {{ r.morador.username }}{% endif %}
            </div>
          </div>
          <span class="pill pill-aprovada">
            <i data-lucide="check-circle" class="w-3 h-3"></i>
            {{ r.get_status_display|default:"Agendada" }}
          </span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Nenhuma reserva hoje.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Inadimplentes (lista curta) -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Inadimplentes</h2>
      <a href="{% url 'financeiro:minhas_cobrancas' %}" class="text-sm link">ver todos ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for l in inadimplentes %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0">
            <div class="font-medium">R$ {{ l.valor }}</div>
            <div class="text-gray-600 text-sm">
              Venceu {{ l.vencimento|date:"d/m" }}
              {% if l.unidade %} ‚Ä¢ {{ l.unidade.condominio.nome }}{% if l.unidade.bloco %} - {{ l.unidade.bloco.nome }}{% endif %} - {{ l.unidade.identificacao }}{% endif %}
            </div>
          </div>
          <span class="pill pill-vencido">
            <i data-lucide="alert-triangle" class="w-3 h-3"></i>
            Vencido
          </span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Sem inadimplentes üëè</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Assembleias (no lugar de pendentes) -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg flex items-center gap-2">
        Assembleias
        {% if has_asm_novas %}
          <span class="inline-block w-2 h-2 rounded-full bg-red-500"></span>
        {% endif %}
      </h2>
      <a href="{% url 'assembleias:lista' %}" class="text-sm link">ver todas ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for a in assembleias_proximas %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0">
            <a href="{% url 'assembleias:detalhe' a.id %}" class="font-medium hover:underline truncate">{{ a.titulo }}</a>
            <div class="text-gray-600 text-sm">
              {{ a.quando|date:"d/m/Y H:i" }}
              {% if a.condominio %} ‚Ä¢ {{ a.condominio.nome }}{% endif %}
            </div>
          </div>
          <span class="pill pill-aprovada">
            <i data-lucide="calendar" class="w-3 h-3"></i>
            Em breve
          </span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Nenhuma assembleia pr√≥xima.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Avisos -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Avisos recentes</h2>
      <a href="/admin/comunicados/aviso/" class="text-sm link">gerenciar ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for a in avisos %}
        <li class="py-3 flex items-center justify-between gap-3">
          <span class="truncate pr-3">{{ a.titulo }}</span>
          <span class="text-gray-500 text-sm whitespace-nowrap">{{ a.criado_em|date:"d/m" }}</span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Sem avisos no momento.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Pr√≥ximos eventos -->
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Pr√≥ximos eventos</h2>
      <a href="{% url 'galeria:lista' %}" class="text-sm link">ver todos ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for e in eventos %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0">
            <div class="font-medium truncate">{{ e.titulo }}</div>
            <div class="text-gray-600 text-sm">
              {% if e.data %}{{ e.data|date:"d/m/Y" }}{% elif e.quando %}{{ e.quando|date:"d/m/Y H:i" }}{% elif e.inicio %}{{ e.inicio|date:"d/m/Y H:i" }}{% else %}‚Äî{% endif %}
              {% if e.local %} ‚Ä¢ {{ e.local }}{% endif %}
            </div>
          </div>
          <span class="pill pill-aprovada">
            <i data-lucide="calendar-days" class="w-3 h-3"></i>
            Evento
          </span>
        </li>
      {% empty %}
        <li class="py-8 text-sm text-gray-500 text-center">Nenhum evento programado.</li>
      {% endfor %}
    </ul>
  </div>

</div>
{% endblock %} {% endcomment %}