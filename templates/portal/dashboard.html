{% extends "base.html" %}
{% block title %}Dashboard ‚Ä¢ CondoX{% endblock %}

{% block content %}
<style>
  /* evita corte de conte√∫do dentro dos cards */
  .card { overflow: visible; }
  /* permite que textos grandes quebrem em qualquer ponto */
  .break-anywhere { word-break: break-word; overflow-wrap: anywhere; }
</style>

<header class="mb-6">
  <div class="flex items-center justify-between gap-3">
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Dashboard</h1>
      <p class="text-gray-500">Vis√£o r√°pida das opera√ß√µes do condom√≠nio.</p>
    </div>
    <div class="flex gap-2">
      <a href="{% url 'reservas:areas_list' %}" class="btn btn-primary">
        <i data-lucide="calendar-plus" class="w-4 h-4"></i> Nova reserva
      </a>
      <a href="{% url 'financeiro:minhas_cobrancas' %}" class="btn btn-ghost">
        <i data-lucide="wallet" class="w-4 h-4"></i> Financeiro
      </a>
    </div>
  </div>
</header>

{# ---------- KPIs ---------- #}
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="card p-5">
    <div class="text-xs font-semibold text-gray-500 uppercase">Em uso agora</div>
    <div class="text-3xl font-bold mt-1">{{ kpi_em_uso_agora|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-2">√Åreas em andamento</div>
  </div>

  <div class="card p-5">
    <div class="text-xs font-semibold text-gray-500 uppercase">Reservas hoje</div>
    <div class="text-3xl font-bold mt-1">{{ kpi_reservas_hoje|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-2">Total de reservas do dia</div>
  </div>

  <div class="card p-5 {% if has_inadimplentes %}ring-1 ring-red-200{% endif %}">
    <div class="text-xs font-semibold text-gray-500 uppercase">Inadimplentes</div>
    <div class="text-3xl font-bold mt-1 {% if has_inadimplentes %}text-red-600{% endif %}">
      {{ kpi_inadimplentes|default:"0" }}
    </div>
    <div class="text-sm text-gray-500 mt-2">Vencidos e n√£o pagos</div>
  </div>

  <div class="card p-5">
    <div class="text-xs font-semibold text-gray-500 uppercase">Pendentes</div>
    <div class="text-3xl font-bold mt-1 text-amber-600">{{ kpi_pendentes|default:"0" }}</div>
    <div class="text-sm text-gray-500 mt-2">A vencer</div>
  </div>
</div>

{# ---------- Linha 2: Em uso ‚Ä¢ Reservas hoje ---------- #}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Em uso agora</h2>
      <a class="text-sm link whitespace-nowrap" href="{% url 'reservas:areas_list' %}">reservar ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for r in em_uso %}
        <li class="py-3">
          <div class="font-medium break-anywhere">{{ r.area.nome }} ‚Ä¢ {{ r.morador }}</div>
          <div class="text-sm text-gray-600">{{ r.inicio|date:"H:i" }}‚Äì{{ r.fim|date:"H:i" }}</div>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Nenhuma √°rea em uso.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Reservas hoje</h2>
      <a class="text-sm link whitespace-nowrap" href="{% url 'reservas:areas_list' %}">ver √°reas ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for r in reservas_hoje %}
        <li class="py-3">
          <div class="font-medium break-anywhere">{{ r.area.nome }} ‚Ä¢ {{ r.morador }}</div>
          <div class="text-sm text-gray-600">{{ r.inicio|date:"H:i" }}‚Äì{{ r.fim|date:"H:i" }}</div>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Nenhuma reserva hoje.</li>
      {% endfor %}
    </ul>
  </div>
</div>

{# ---------- Linha 3: Inadimplentes ‚Ä¢ Assembleias ---------- #}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Inadimplentes</h2>
      <a class="text-sm link whitespace-nowrap" href="{% url 'financeiro:minhas_cobrancas' %}">ver todos ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for l in inadimplentes %}
        <li class="py-3">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0 break-anywhere">
              <div class="font-semibold">R$ {{ l.valor }}</div>
              <div class="text-sm text-gray-600">
                Venceu {{ l.vencimento|date:"d/m" }}
                {% if l.unidade %} ‚Ä¢ {{ l.unidade.condominio.nome }} - {{ l.unidade }}{% endif %}
              </div>
            </div>
            <span class="pill bg-red-100 text-red-700 whitespace-nowrap">Vencido</span>
          </div>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Sem inadimplentes üëè</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg flex items-center gap-2">
        Assembleias
        {% if has_asm_novas %}
          <span class="inline-flex w-2 h-2 rounded-full bg-red-600 align-middle"></span>
        {% endif %}
      </h2>
      <a class="text-sm link whitespace-nowrap" href="{% url 'assembleias:lista' %}">ver todas ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for a in assembleias_proximas %}
        <li class="py-3">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0 break-anywhere">
              <a class="font-medium hover:underline" href="{% url 'assembleias:detalhe' a.id %}">
                {{ a.titulo }}
              </a>
              <div class="text-sm text-gray-600">
                {{ a.quando|date:"d/m/Y H:i" }}
                {% if a.condominio %} ‚Ä¢ {{ a.condominio.nome }}{% endif %}
              </div>
            </div>
            <span class="pill bg-indigo-100 text-indigo-700 whitespace-nowrap">Em breve</span>
          </div>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Nenhuma assembleia pr√≥xima.</li>
      {% endfor %}
    </ul>
  </div>
</div>

{# ---------- Linha 4: Avisos ‚Ä¢ Eventos ---------- #}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Avisos recentes</h2>
      <a class="text-sm link whitespace-nowrap" href="/comunicados/">ver todos ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for a in avisos %}
        <li class="py-3 flex items-center justify-between gap-3">
          <span class="break-anywhere">{{ a.titulo }}</span>
          <span class="text-sm text-gray-500 whitespace-nowrap">{{ a.criado_em|date:"d/m" }}</span>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Sem avisos no momento.</li>
      {% endfor %}
    </ul>
  </div>

  <div class="card p-5">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-lg">Pr√≥ximos eventos</h2>
      <a class="text-sm link whitespace-nowrap" href="{% url 'galeria:lista' %}">ver todos ‚Üí</a>
    </div>
    <ul class="divide-y divide-gray-200">
      {% for e in eventos %}
        <li class="py-3 flex items-center justify-between gap-3">
          <div class="min-w-0 break-anywhere">
            <div class="font-medium">{{ e.titulo }}</div>
            <div class="text-sm text-gray-600">
              {% if e.data %}{{ e.data|date:"d/m/Y" }}{% elif e.quando %}{{ e.quando|date:"d/m/Y H:i" }}{% elif e.inicio %}{{ e.inicio|date:"d/m/Y H:i" }}{% else %}‚Äî{% endif %}
              {% if e.local %} ‚Ä¢ {{ e.local }}{% endif %}
            </div>
          </div>
          <span class="pill bg-emerald-100 text-emerald-700 whitespace-nowrap">Evento</span>
        </li>
      {% empty %}
        <li class="py-8 text-center text-gray-500">Nenhum evento programado.</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}