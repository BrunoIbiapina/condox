<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}CondoX{% endblock %}</title>

    <!-- Fonts + Tailwind -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root{
        --brand:#16a34a;           /* verde-600 */
        --brand-500:#22c55e;       /* verde-500 hover */
        --ink:#0f172a;             /* slate-900 */
        --muted:#64748b;           /* slate-500 */
        --card:#ffffff;
        --line:#e2e8f0;            /* slate-200 */
        --bg:#f8fafc;              /* slate-50 */
        --chip:#f1f5f9;            /* slate-100 */
      }
      html,body{height:100%}
      body{font-family:Inter, ui-sans-serif, system-ui; background:var(--bg); color:var(--ink);}
      .card{background:var(--card); border:1px solid var(--line); border-radius:18px; box-shadow:0 8px 30px rgba(2,6,23,.05);}
      .btn{display:inline-flex; align-items:center; gap:.5rem; padding:.65rem 1rem; border-radius:12px; border:1px solid var(--line); font-weight:600;}
      .btn-primary{background:var(--brand); color:#fff; border-color:var(--brand);}
      .btn-primary:hover{background:var(--brand-500)}
      .btn-secondary{background:#fff; color:var(--muted); border-color:var(--line);}
      .btn-secondary:hover{background:var(--chip)}
      .btn-ghost{background:#fff}
      .chip{background:var(--chip); color:var(--muted); padding:.35rem .6rem; border-radius:999px; font-weight:600; font-size:.8rem}
      .field{background:#fff; border:1px solid var(--line); border-radius:12px; padding:.65rem .9rem; outline:none}
      .field:focus{border-color:var(--brand); box-shadow:0 0 0 4px rgba(34,197,94,.15)}
      .pill{display:inline-flex; align-items:center; gap:.35rem; padding:.4rem .75rem; border-radius:25px; font-size:.75rem; font-weight:700; letter-spacing:.02em; text-transform:uppercase; box-shadow:0 2px 6px rgba(0,0,0,.08)}
      
      /* Status pills específicos */
      .pill-em-uso{background:linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color:#15803d; border:1px solid #86efac}
      .pill-aprovada{background:linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color:#1d4ed8; border:1px solid #93c5fd}
      .pill-pendente{background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color:#d97706; border:1px solid #fbbf24}
      .pill-cancelada{background:linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); color:#6b7280; border:1px solid #d1d5db}
      .pill-online{background:linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color:#15803d; border:1px solid #86efac; animation:pulse-green 2s infinite}
      
      /* Animação para status online */
      @keyframes pulse-green {
        0%, 100% { box-shadow: 0 2px 6px rgba(0,0,0,.08), 0 0 0 0 rgba(34, 197, 94, 0.4); }
        50% { box-shadow: 0 2px 6px rgba(0,0,0,.08), 0 0 0 8px rgba(34, 197, 94, 0); }
      }
    </style>
  </head>
  <body class="min-h-full">
    <!-- Layout sem sidebar - Full width para porteiro -->
    <div class="min-h-screen">
      <!-- Topbar simplificada -->
      <header class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b border-[var(--line)]">
        <div class="px-4 md:px-8 py-4 flex items-center justify-between">
          <!-- Logo e título -->
          <div class="flex items-center gap-3">
            <img src="https://img.icons8.com/fluency/48/checked.png" class="w-8 h-8" alt="">
            <span class="font-bold text-xl text-gray-900">CondoX</span>
            <span class="chip">Painel do Porteiro</span>
          </div>

          <!-- Usuário e ações -->
          <div class="flex items-center gap-3">
            <span class="hidden sm:inline text-sm text-gray-600">
              {{ agora|date:"l, d/m/Y - H:i" }}
            </span>
            
            <div class="flex items-center gap-2">
              <span class="chip">{{ user.first_name|default:user.username|default:'Porteiro' }}</span>
              <img class="w-8 h-8 rounded-full ring-2 ring-[var(--line)]" 
                   src="https://api.dicebear.com/9.x/identicon/svg?seed={{ user.username|default:'porteiro' }}" 
                   alt="Avatar">
            </div>

            <!-- Botão de logout -->
            {% if user.is_authenticated %}
              <form method="post" action="{% url 'logout' %}" class="inline">
                {% csrf_token %}
                <button class="btn btn-secondary" title="Sair do sistema">
                  <i data-lucide="log-out" class="w-4 h-4"></i>
                  <span class="hidden sm:inline">Sair</span>
                </button>
              </form>
            {% endif %}
          </div>
        </div>
      </header>

      <!-- Mensagens -->
      {% if messages %}
        <div class="px-4 md:px-8 pt-4 space-y-2">
          {% for message in messages %}
            <div class="card px-4 py-3 text-sm {% if message.tags == 'success' %}text-green-700 bg-green-50 border-green-200{% elif message.tags == 'error' %}text-red-700 bg-red-50 border-red-200{% else %}text-slate-700{% endif %}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Conteúdo principal - Full width -->
      <main class="px-4 md:px-8 py-6">
        {% block content %}{% endblock %}
      </main>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.lucide) lucide.createIcons();

        // Auto-refresh da página a cada 5 minutos para manter dados atualizados
        setInterval(() => {
          window.location.reload();
        }, 5 * 60 * 1000); // 5 minutos

        // Mostrar horário atualizado
        function updateTime() {
          const now = new Date();
          const timeString = now.toLocaleString('pt-BR');
          const timeElement = document.querySelector('.current-time');
          if (timeElement) {
            timeElement.textContent = timeString;
          }
        }

        // Atualizar horário a cada segundo
        updateTime();
        setInterval(updateTime, 1000);
      });
    </script>
  </body>
</html>
